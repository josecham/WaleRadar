<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhaleRadar Pro - Institutional Flow</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&family=JetBrains+Mono&display=swap');
        body { background-color: #05070a; font-family: 'Space Grotesk', sans-serif; color: #f8fafc; margin: 0; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .whale-card { background: linear-gradient(145deg, #0f172a, #020617); border: 1px solid #1e293b; }
        .live-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        .mega-whale-alert {
            animation: alert-flash 0.8s infinite alternate;
            border: 2px solid #3b82f6;
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.4);
        }
        @keyframes alert-flash {
            from { background-color: rgba(59, 130, 246, 0.1); transform: scale(1); }
            to { background-color: rgba(59, 130, 246, 0.3); transform: scale(1.02); }
        }

        .gauge-container { position: relative; width: 180px; height: 90px; margin: 0 auto; overflow: hidden; }
        .gauge-bg { width: 180px; height: 180px; border-radius: 50%; border: 15px solid #1e293b; border-bottom-color: transparent; border-left-color: transparent; transform: rotate(-135deg); }
        .gauge-fill { 
            position: absolute; top: 0; left: 0; width: 180px; height: 180px; border-radius: 50%; 
            border: 15px solid transparent; border-bottom-color: currentColor; border-left-color: currentColor; 
            transform: rotate(var(--angle)); transition: all 1s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .gauge-needle {
            position: absolute; bottom: 0; left: 50%; width: 2px; height: 70px; 
            background: white; transform-origin: bottom; 
            transform: translateX(-50%) rotate(var(--needle-angle)); transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideIn { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-item { animation: slideIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const WhaleRadarApp = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [pass, setPass] = useState("");
            const [events, setEvents] = useState([]);
            const [sentimentScore, setSentimentScore] = useState(50);
            const [megaWhale, setMegaWhale] = useState(null);
            const [megaWhaleCount, setMegaWhaleCount] = useState(0);

            useEffect(() => {
                if (!isAuthenticated) return;
                const socket = new WebSocket('wss://ws.blockchain.info/inv');
                socket.onopen = () => socket.send(JSON.stringify({ "op": "unconfirmed_sub" }));

                socket.onmessage = (msg) => {
                    const data = JSON.parse(msg.data);
                    if (data.op === "utx") {
                        const totalSatoshis = data.x.out.reduce((acc, out) => acc + out.value, 0);
                        const btcValue = totalSatoshis / 100000000;

                        if (btcValue >= 5) {
                            const isBull = data.x.out.length <= 2;
                            
                            if (btcValue >= 1000) {
                                setMegaWhale({ amount: btcValue.toLocaleString(), type: isBull ? 'COMPRA' : 'VENTA' });
                                setMegaWhaleCount(prev => prev + 1);
                                const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
                                audio.play().catch(() => {});
                                setTimeout(() => setMegaWhale(null), 7000);
                            }

                            const newEvent = {
                                id: data.x.hash,
                                txid: data.x.hash,
                                amount: btcValue,
                                amountFormatted: btcValue.toLocaleString(undefined, {minimumFractionDigits: 2}),
                                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                                action: isBull ? { label: 'BUY', type: 'BULL' } : { label: 'SELL', type: 'BEAR' }
                            };
                            
                            setEvents(prev => [newEvent, ...prev].slice(0, 8));
                            setSentimentScore(prev => {
                                const adjustment = isBull ? 0.8 : -0.8;
                                return Math.round(Math.min(Math.max(prev + adjustment, 5), 95));
                            });
                        }
                    }
                };
                return () => socket.close();
            }, [isAuthenticated]);

            const stats = useMemo(() => {
                const buy = events.filter(e => e.action.type === 'BULL').reduce((acc, e) => acc + e.amount, 0);
                const sell = events.filter(e => e.action.type === 'BEAR').reduce((acc, e) => acc + e.amount, 0);
                const total = buy + sell;
                return { 
                    buyVol: buy, 
                    sellVol: sell, 
                    buyPer: total > 0 ? (buy / total) * 100 : 50,
                    sellPer: total > 0 ? (sell / total) * 100 : 50
                };
            }, [events]);

            const gaugeAngle = -135 + (sentimentScore * 1.8); 
            const needleAngle = -90 + (sentimentScore * 1.8);
            
            const getSentimentColor = () => {
                if (sentimentScore > 70) return 'text-green-500';
                if (sentimentScore > 40) return 'text-yellow-500';
                return 'text-red-500';
            };

            const getSentimentLabel = () => {
                if (sentimentScore > 75) return 'EXTREME GREED';
                if (sentimentScore > 55) return 'GREED';
                if (sentimentScore > 45) return 'NEUTRAL';
                if (sentimentScore > 25) return 'FEAR';
                return 'EXTREME FEAR';
            };

            if (!isAuthenticated) {
                return (
                    <div className="fixed inset-0 bg-black flex items-center justify-center p-6">
                        <div className="whale-card p-10 rounded-[3rem] w-full max-w-xs text-center border-blue-500/30">
                            <i className="ph-fill ph-shield-star text-5xl text-blue-500 mb-6 block mx-auto"></i>
                            <h2 className="text-xl font-black uppercase italic mb-8 tracking-tighter">WhaleRadar Access</h2>
                            <input type="password" value={pass} onChange={(e) => setPass(e.target.value)} placeholder="CONTRASEÑA" className="w-full bg-black border border-white/10 rounded-2xl py-4 text-center mono text-blue-400 mb-4 outline-none" />
                            <button onClick={() => pass.toUpperCase() === "WHALE2026" && setIsAuthenticated(true)} className="w-full bg-blue-600 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest text-white">Conectar Radar</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-md mx-auto min-h-screen bg-[#05070a] pb-32">
                    {megaWhale && (
                        <div className="fixed top-20 left-4 right-4 z-50 mega-whale-alert p-6 rounded-3xl text-center backdrop-blur-xl">
                            <i className="ph-fill ph-rocket-launch text-4xl text-blue-400 mb-2 animate-bounce"></i>
                            <h2 className="text-2xl font-black tracking-tighter text-white uppercase italic">MEGA WHALE ALERT</h2>
                            <p className="mono text-blue-400 text-lg font-bold">{megaWhale.amount} BTC en {megaWhale.type}</p>
                        </div>
                    )}

                    <header className="p-6 flex justify-between items-center sticky top-0 bg-black/80 backdrop-blur-lg z-20 border-b border-white/5">
                        <h1 className="text-2xl font-black italic uppercase tracking-tighter italic text-white">Wale<span className="text-blue-400">Radar</span></h1>
                        <div className="flex items-center gap-2">
                            <span className="w-2 h-2 bg-blue-500 rounded-full live-dot"></span>
                            <span className="text-[9px] mono font-bold text-gray-500 uppercase tracking-widest">Live Flow</span>
                        </div>
                    </header>

                    <div className="p-6">
                        {/* GAUGE SENTIMIENTO */}
                        <div className="whale-card p-8 rounded-[3rem] mb-6 text-center border-blue-500/10">
                            <h3 className="text-[10px] mono text-gray-500 font-black uppercase tracking-[0.4em] mb-6 italic">Market Sentiment</h3>
                            <div className="gauge-container mb-4">
                                <div className="gauge-bg"></div>
                                <div className={`gauge-fill ${getSentimentColor()}`} style={{ '--angle': `${gaugeAngle}deg` }}></div>
                                <div className="gauge-needle" style={{ '--needle-angle': `${needleAngle}deg` }}></div>
                            </div>
                            <div className={`text-2xl font-black tracking-tighter ${getSentimentColor()}`}>
                                {sentimentScore} - {getSentimentLabel()}
                            </div>
                        </div>

                        {/* BARRA DE PODER */}
                        <div className="whale-card p-6 rounded-[2.5rem] mb-6 border-white/5">
                            <div className="flex justify-between text-[10px] mono mb-3 uppercase font-black italic">
                                <span className="text-green-400">Bulls Power {stats.buyPer.toFixed(0)}%</span>
                                <span className="text-red-400">Bears Power {stats.sellPer.toFixed(0)}%</span>
                            </div>
                            <div className="w-full h-4 bg-gray-900 rounded-full overflow-hidden flex border border-white/5">
                                <div className="h-full bg-green-500 transition-all duration-1000" style={{ width: `${stats.buyPer}%` }}></div>
                                <div className="h-full bg-red-500 transition-all duration-1000" style={{ width: `${stats.sellPer}%` }}></div>
                            </div>
                        </div>

                        {/* STATS RÁPIDAS */}
                        <div className="flex gap-4 mb-10">
                            <div className="flex-1 whale-card p-4 rounded-3xl text-center">
                                <p className="text-[8px] uppercase text-gray-500 mb-1 font-black">Mega Whales</p>
                                <p className="text-xl font-black text-blue-400">{megaWhaleCount}</p>
                            </div>
                            <div className="flex-1 whale-card p-4 rounded-3xl text-center">
                                <p className="text-[8px] uppercase text-gray-500 mb-1 font-black">Vol (10b)</p>
                                <p className="text-xl font-black text-white">{((stats.buyVol + stats.sellVol) / 10).toFixed(0)}</p>
                            </div>
                        </div>

                        {/* LISTA DE BLOQUES */}
                        <div className="space-y-4">
                            <h3 className="text-[10px] mono text-gray-700 font-black uppercase tracking-[0.4em] mb-4 text-center italic">Institutional Live Feed</h3>
                            {events.map(ev => (
                                <div key={ev.id} className="whale-card p-6 rounded-[2.5rem] border-white/5 animate-item">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <span className="text-[8px] mono text-blue-500 font-bold uppercase">On-Chain Data</span>
                                            <div className="text-2xl font-black text-white">{ev.amountFormatted} BTC</div>
                                        </div>
                                        <div className={`px-4 py-2 rounded-full text-[10px] font-black ${ev.action.type === 'BULL' ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
                                            {ev.action.label}
                                        </div>
                                    </div>
                                    <div className="mt-4 text-[9px] mono text-gray-600 font-bold">{ev.txid.substring(0,24)}...</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-black/95 backdrop-blur-xl border-t border-white/5 p-8 flex justify-around items-center z-50">
                        <i className="ph-fill ph-radar text-3xl text-blue-500"></i>
                        <i className="ph ph-shield-check text-2xl text-gray-600"></i>
                        <i className="ph ph-user text-2xl text-gray-600"></i>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WhaleRadarApp />);
    </script>
</body>
</html>
